<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="post-body">
    <div class="post-container">
        <div class="board" id="dashboard"></div>
        
          <div class="board" id="profile">
            <h1 class="post-header">PROFILE</h1>
            <br>
            <img src="/<%= profile.image %>" alt="profile image" style="width: 200px; height: 200px; border-radius: 50%;" >
            <p><strong>Username:</strong> <%= profile.user ? profile.user.username : 'Unknown user' %></p>
            <% if (profile) { %>
              <p><strong>Bio:</strong> <%= profile.bio %></p>
              <p><strong>Location:</strong> <%= profile.location || 'Location not specified' %></p>
              <p><strong>Pronoun:</strong> <%= profile.pronoun || 'Not specified' %></p>
              <button type="button" class="follow-btn" data-user-id="<%= profile.user.id %>" data-following="<%= profile.isFollowing ? 'true' : 'false' %>">
                <%= profile.isFollowing ? 'Unfollow' : 'Follow' %>
            </button>
            <% } else { %>
              <p>User or profile not found.</p>
            <% } %>
          </div>
        </div> 
        <script>
          // To follow a user
document.addEventListener('click', e => {
  const btn = e.target.closest('.follow-btn');
  if (!btn) return;

  const receiverId = btn.dataset.userId;
  const isFollowing = btn.dataset.following === 'true';

  // Choose endpoint and new text
  const url = isFollowing
    ? `/users/unfollow/${receiverId}`
    : `/users/follow/${receiverId}`;

  const newText = isFollowing ? 'Follow' : 'Unfollow';
  const newState = !isFollowing;

  fetch(url, { method: 'POST'})

  .then(r => r.json())
  .then(data => 
    {
    btn.textContent = data.following ? 'Unfollow' : 'Follow';
    btn.dataset.following = String(data.following);
  })
  .catch(err => console.error(err));
});


        </script>   
</body>
</html>

